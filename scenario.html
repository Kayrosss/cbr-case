<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞: —Å–∏–º—É–ª—è—Ç–æ—Ä</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(145deg, #0a2a3f, #1a4a6a);
      color: white;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      padding: 20px;
    }

    /* –§–æ–Ω–æ–≤—ã–µ –≤–∞–ª—é—Ç—ã */
    .currency-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .currency-symbol {
      position: absolute;
      font-size: 50px;
      color: rgba(255,255,255,0.03);
      animation: float 20s infinite;
    }

    @keyframes float {
      0%,100% { transform: translate(0,0); }
      50% { transform: translate(30px, -30px); }
    }

    /* –ë–∞–Ω–Ω–µ—Ä –º–∏—Ñ–∞ */
    .myth-banner {
      background: rgba(180, 30, 30, 0.9);
      backdrop-filter: blur(5px);
      border: 2px solid #ffd966;
      border-radius: 60px;
      padding: 12px 25px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      box-shadow: 0 0 20px rgba(255, 100, 100, 0.5);
      animation: glow 2s infinite;
    }

    @keyframes glow {
      0% { box-shadow: 0 0 20px rgba(255, 100, 100, 0.5); }
      50% { box-shadow: 0 0 30px rgba(255, 150, 150, 0.8); }
      100% { box-shadow: 0 0 20px rgba(255, 100, 100, 0.5); }
    }

    .myth-banner-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .myth-banner-left span {
      font-size: 32px;
    }

    .myth-banner h2 {
      font-size: 20px;
      font-weight: bold;
      color: white;
    }

    .myth-banner p {
      font-size: 18px;
      color: #ffd966;
      font-style: italic;
    }

    .myth-banner-right {
      background: #ffd966;
      color: #0a2a3f;
      padding: 8px 20px;
      border-radius: 40px;
      font-weight: bold;
    }

    /* –ö–Ω–æ–ø–∫–∞ "–ß—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏..." */
    .what-if-btn {
      background: #1e4a6a;
      border: 2px solid #ffd966;
      color: white;
      font-size: 16px;
      padding: 8px 15px;
      border-radius: 40px;
      cursor: pointer;
      margin-left: 15px;
      transition: 0.2s;
    }

    .what-if-btn:hover {
      background: #2a6a8a;
      transform: scale(1.05);
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .game-container {
      position: relative;
      z-index: 10;
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(10, 35, 55, 0.7);
      backdrop-filter: blur(12px);
      border-radius: 60px;
      padding: 30px;
      border: 2px solid rgba(255,215,0,0.3);
      box-shadow: 0 30px 60px -20px black;
    }

    /* –®–∞–ø–∫–∞ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .scenario-menu-btn {
      background: #1e4a6a;
      border: 2px solid #ffd966;
      color: white;
      font-size: 18px;
      font-weight: bold;
      padding: 10px 25px;
      border-radius: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: 0.2s;
    }

    .scenario-menu-btn:hover {
      background: #2a6a8a;
      transform: scale(1.05);
    }

    .header-buttons {
      display: flex;
      gap: 10px;
      position: relative;
    }

    .settings-btn, .help-btn {
      background: none;
      border: 2px solid #ffd966;
      color: #ffd966;
      font-size: 28px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
      background: rgba(0,0,0,0.3);
    }

    .settings-btn:hover, .help-btn:hover {
      background: #ffd966;
      color: #0a2a3f;
      transform: scale(1.1);
    }

    /* –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    .settings-menu {
      position: absolute;
      top: 60px;
      right: 0;
      background: rgba(10, 35, 55, 0.95);
      backdrop-filter: blur(10px);
      border: 2px solid #ffd966;
      border-radius: 30px;
      padding: 25px;
      z-index: 1000;
      min-width: 280px;
      box-shadow: 0 20px 40px -10px black;
    }

    .settings-menu h3 {
      color: #ffd966;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-size: 18px;
    }

    .toggle {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider-toggle {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255,255,255,0.2);
      border-radius: 30px;
      border: 2px solid #ffd966;
    }

    .slider-toggle:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 2px;
      bottom: 2px;
      background-color: #ffd966;
      border-radius: 50%;
      transition: 0.2s;
    }

    input:checked + .slider-toggle {
      background-color: #4caf50;
    }

    input:checked + .slider-toggle:before {
      transform: translateX(30px);
    }

    .volume-slider {
      width: 150px;
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      -webkit-appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #ffd966;
      border-radius: 50%;
      border: 2px solid white;
      cursor: pointer;
    }

    /* –ò–Ω—Ñ–æ –ø–∞–Ω–µ–ª—å */
    .info-panel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.3);
      padding: 15px 25px;
      border-radius: 50px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
      border: 1px solid rgba(255,215,0,0.3);
    }

    .year-info {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .meeting {
      font-size: 20px;
      background: #ff6b4a;
      padding: 5px 15px;
      border-radius: 40px;
      font-weight: bold;
    }

    .year {
      font-size: 28px;
      font-weight: bold;
      color: #ffd966;
    }

    .quarter {
      font-size: 20px;
      background: rgba(255,215,0,0.2);
      padding: 5px 15px;
      border-radius: 40px;
    }

    .trust {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.1);
      padding: 8px 20px;
      border-radius: 40px;
    }

    .trust-bar {
      width: 100px;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      overflow: hidden;
    }

    .trust-fill {
      height: 100%;
      background: #ffd966;
      transition: width 0.3s;
    }

    .wiki-link a {
      color: white;
      text-decoration: none;
      border-bottom: 1px dashed #ffd966;
    }

    /* –¶–µ–ª—å —Å—Ü–µ–Ω–∞—Ä–∏—è */
    .scenario-goal {
      background: rgba(255,215,0,0.1);
      border: 1px solid #ffd966;
      border-radius: 40px;
      padding: 15px 25px;
      margin-bottom: 25px;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .goal-text {
      color: #ffd966;
      font-weight: bold;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .metric-card {
      background: rgba(255,255,255,0.08);
      border-radius: 28px;
      padding: 25px;
      border: 2px solid transparent;
      position: relative;
      transition: 0.3s;
    }

    .metric-card:hover {
      transform: translateY(-5px);
      background: rgba(255,255,255,0.12);
      border-color: #ffd966;
    }

    .metric-card.critical {
      border-color: #b22222;
      box-shadow: 0 0 20px #b22222;
    }

    .metric-card.good {
      border-color: #4caf50;
    }

    .metric-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .metric-name {
      font-size: 18px;
      font-weight: 600;
    }

    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: rgba(255,215,0,0.2);
      border-radius: 50%;
      cursor: pointer;
      font-weight: bold;
      color: #ffd966;
      transition: 0.2s;
    }

    .help-icon:hover {
      background: #ffd966;
      color: #0a2a3f;
    }

    .metric-value {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .real-rate {
      font-size: 18px;
      opacity: 0.9;
      color: #ffd966;
    }

    .metric-detail {
      font-size: 14px;
      color: #ffd966;
      margin-top: 5px;
    }

    .metric-hint {
      margin-top: 12px;
      padding: 10px;
      border-radius: 16px;
      background: rgba(255,107,74,0.2);
      border-left: 4px solid #ff6b4a;
      font-size: 14px;
      display: none;
    }

    .metric-hint.show {
      display: block;
    }

    /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .control-panel {
      background: rgba(0,0,0,0.3);
      border-radius: 40px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .slider-container {
      margin: 25px 0;
      position: relative;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 22px;
      margin-bottom: 15px;
    }

    .rate-big {
      font-size: 42px;
      font-weight: bold;
      color: #ff6b4a;
    }

    input[type=range] {
      width: 100%;
      height: 12px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      -webkit-appearance: none;
    }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 30px;
      height: 30px;
      background: #ffd966;
      border-radius: 50%;
      border: 3px solid white;
      cursor: pointer;
    }

    .forecast {
      background: rgba(255,215,0,0.1);
      border-left: 6px solid #ffd966;
      padding: 20px;
      border-radius: 20px;
      margin: 20px 0;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }

    .primary-btn {
      background: #ff6b4a;
      border: none;
      color: white;
      font-size: 22px;
      font-weight: bold;
      padding: 18px 40px;
      border-radius: 50px;
      cursor: pointer;
      flex: 2;
      transition: 0.2s;
    }

    .primary-btn:hover {
      background: #ff8255;
      transform: scale(1.02);
    }

    .secondary-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      font-size: 18px;
      padding: 18px 30px;
      border-radius: 50px;
      cursor: pointer;
      flex: 1;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }

    .modal-content {
      background: #1a3a5c;
      padding: 40px;
      border-radius: 40px;
      max-width: 600px;
      border: 2px solid #ffd966;
    }

    .modal-content h3 {
      font-size: 28px;
      margin-bottom: 20px;
      text-align: center;
    }

    .close-modal {
      background: #ff6b4a;
      border: none;
      color: white;
      padding: 12px 30px;
      border-radius: 40px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è */
    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .scenario-option {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 30px;
      padding: 15px;
      cursor: pointer;
      transition: 0.2s;
    }

    .scenario-option:hover {
      background: rgba(255,215,0,0.2);
      transform: translateY(-3px);
    }

    .scenario-option h4 {
      color: #ffd966;
      margin-bottom: 5px;
    }

    .scenario-option p {
      font-size: 14px;
      opacity: 0.8;
    }

    /* –ì—Ä–∞—Ñ–∏–∫ */
    .chart-container {
      margin-top: 30px;
      background: rgba(0,0,0,0.2);
      border-radius: 30px;
      padding: 25px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .chart-title {
      font-size: 22px;
      font-weight: bold;
    }

    .chart-legend {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }

    .chart-wrapper {
      position: relative;
      height: 250px;
      width: 100%;
    }

    /* –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç */
    .assistant {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: row-reverse;
      align-items: flex-end;
      gap: 15px;
      z-index: 1500;
    }

    .assistant-img {
      width: 120px;
      filter: drop-shadow(0 10px 10px black);
    }

    .assistant-bubble {
      background: #0f2336;
      padding: 15px 20px;
      border-radius: 24px;
      max-width: 300px;
      border-bottom-right-radius: 8px;
      border: 2px solid #ffd966;
      font-size: 14px;
      line-height: 1.5;
    }

    .result-screen {
      text-align: center;
      padding: 40px;
    }

    .win { color: #4caf50; }
    .neutral { color: #ffd966; }

    .what-if-panel {
      background: rgba(0,0,0,0.5);
      border-radius: 20px;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid #ffd966;
    }
  </style>
</head>
<body>

<!-- –ê—É–¥–∏–æ -->
<audio id="bgMusic" loop preload="auto">
  <source src="assets/sounds/FonMelody.mp3" type="audio/mp3">
</audio>
<audio id="soundButton" preload="auto">
  <source src="assets/sounds/ButtonClick.mp3" type="audio/mp3">
</audio>
<audio id="soundSlider" preload="auto">
  <source src="assets/sounds/Slider.mp3" type="audio/mp3">
</audio>
<audio id="soundCash" preload="auto">
  <source src="assets/sounds/CashRegister.mp3" type="audio/mp3">
</audio>
<audio id="soundBell" preload="auto">
  <source src="assets/sounds/TradingBell.mp3" type="audio/mp3">
</audio>
<audio id="soundNoise" preload="auto">
  <source src="assets/sounds/NoiseBurse.mp3" type="audio/mp3">
</audio>
<audio id="soundOvation" preload="auto">
  <source src="assets/sounds/Ovation.mp3" type="audio/mp3">
</audio>

<div class="currency-bg" id="currencyBg"></div>

<!-- –ë–∞–Ω–Ω–µ—Ä –º–∏—Ñ–∞ -->
<div class="myth-banner">
  <div class="myth-banner-left">
    <span>‚ö°</span>
    <div>
      <h2>–ú–ò–§: ¬´–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É, —á—Ç–æ–±—ã –∂–∏–ª—å—ë —Å—Ç–∞–ª–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º¬ª</h2>
      <p>üìâ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: –í—ã—Å–æ–∫–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è —Å—ä–µ–¥–∞–µ—Ç –¥–æ—Ö–æ–¥—ã, –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ</p>
    </div>
  </div>
  <div class="myth-banner-right" id="mythCounter">
    –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏—Ñ
  </div>
</div>

<div class="game-container">
  <!-- –®–∞–ø–∫–∞ -->
  <div class="header">
    <button class="scenario-menu-btn" onclick="openScenarioMenu()">
      <span>üìú</span> –í—ã–±—Ä–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π
    </button>
    <div class="header-buttons">
      <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
      <button class="help-btn" onclick="showHelp()">?</button>
      
      <!-- –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
      <div class="settings-menu" id="settingsMenu" style="display: none;">
        <h3>‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h3>
        <div class="setting-item">
          <span>üîä –ó–≤—É–∫–∏</span>
          <label class="toggle">
            <input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
            <span class="slider-toggle"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>üéµ –ú—É–∑—ã–∫–∞</span>
          <label class="toggle">
            <input type="checkbox" id="musicToggle" checked onchange="toggleMusic()">
            <span class="slider-toggle"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>üó£Ô∏è –ì–æ–ª–æ—Å</span>
          <label class="toggle">
            <input type="checkbox" id="voiceToggle" checked onchange="toggleVoice()">
            <span class="slider-toggle"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>üîâ –ì—Ä–æ–º–∫–æ—Å—Ç—å</span>
          <input type="range" min="0" max="100" value="50" class="volume-slider" id="volumeSlider" oninput="changeVolume(this.value)">
        </div>
      </div>
    </div>
  </div>

  <!-- –ò–Ω—Ñ–æ –ø–∞–Ω–µ–ª—å -->
  <div class="info-panel">
    <div class="year-info">
      <div class="meeting" id="meetingDisplay">1/16</div>
      <div class="year" id="yearDisplay">1992</div>
      <div class="quarter" id="quarterDisplay">I –∫–≤–∞—Ä—Ç–∞–ª</div>
      <div class="trust">
        <span>‚≠ê –î–æ–≤–µ—Ä–∏–µ:</span>
        <div class="trust-bar">
          <div class="trust-fill" id="trustFill" style="width: 65%"></div>
        </div>
        <span id="trustValue">65%</span>
      </div>
    </div>
    <div class="wiki-link" id="wikiLink">
      <a href="#" target="_blank" id="wikiLinkA">üìñ –°–æ–±—ã—Ç–∏—è –ø–µ—Ä–∏–æ–¥–∞</a>
    </div>
  </div>

  <!-- –¶–µ–ª—å —Å—Ü–µ–Ω–∞—Ä–∏—è -->
  <div class="scenario-goal" id="scenarioGoal"></div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π -->
  <div class="metrics-grid" id="metricsGrid"></div>

  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div class="control-panel">
    <div class="slider-container">
      <div class="slider-label">
        <span>üîë –ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ</span>
        <div>
          <span class="rate-big" id="rateDisplay">4.0%</span>
          <button class="what-if-btn" onclick="showWhatIf()">üîÆ –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏...</button>
        </div>
      </div>
      <input type="range" id="keyRateSlider" min="0" max="200" value="4" step="0.5">
      <div style="display: flex; justify-content: space-between; margin-top: 8px;">
        <span>üü¢ 0%</span>
        <span>üî¥ 200%</span>
      </div>
    </div>

    <!-- –ü—Ä–æ–≥–Ω–æ–∑ -->
    <div class="forecast" id="forecastBlock">
      <strong>üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞—Å–µ–¥–∞–Ω–∏—é:</strong> <span id="forecastText">...</span>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="action-buttons">
      <button class="primary-btn" id="applyBtn">‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å —Å—Ç–∞–≤–∫—É</button>
      <button class="secondary-btn" onclick="restartScenario()">üîÑ –ó–∞–Ω–æ–≤–æ</button>
    </div>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ -->
  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">üìä –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</div>
      <div class="chart-legend">
        <div class="legend-item"><span class="legend-color" style="background: #ff6384;"></span> –ò–Ω—Ñ–ª—è—Ü–∏—è</div>
        <div class="legend-item"><span class="legend-color" style="background: #36a2eb;"></span> –ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞</div>
        <div class="legend-item"><span class="legend-color" style="background: #4caf50;"></span> –í–í–ü</div>
        <div class="legend-item"><span class="legend-color" style="background: #ffcd56;"></span> –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è</div>
      </div>
    </div>
    <div class="chart-wrapper">
      <canvas id="economyChart"></canvas>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è -->
<div id="scenarioModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>üìú –í–´–ë–ï–†–ò–¢–ï –°–¶–ï–ù–ê–†–ò–ô</h3>
    <div class="scenario-grid" id="scenarioGrid"></div>
    <button class="close-modal" onclick="closeScenarioMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø—Ä–∞–≤–∫–∏ -->
<div id="helpModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>‚ùì –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h3>
    <p><strong>–¶–µ–ª—å:</strong> –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏—Ñ –æ —Ç–æ–º, —á—Ç–æ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç –∂–∏–ª—å—é.</p>
    <p><strong>16 –∑–∞—Å–µ–¥–∞–Ω–∏–π –¶–ë (2 –≥–æ–¥–∞):</strong> –∫–∞–∂–¥–æ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É.</p>
    <p><strong>–†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞</strong> = –∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ ‚àí –∏–Ω—Ñ–ª—è—Ü–∏—è. –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–µ.</p>
    <p><strong>üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è:</strong> –ø—Ä–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É, –Ω–µ —Ç—Ä–∞—Ç—è —Ö–æ–¥.</p>
    <p><strong>üí° –ì–ª–∞–≤–Ω—ã–π —É—Ä–æ–∫:</strong> —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ –¥–µ–ª–∞–µ—Ç –∂–∏–ª—å—ë –º–µ–Ω–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º!</p>
    <button class="close-modal" onclick="closeHelp()">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞ -->
<div id="termModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3 id="termTitle"></h3>
    <p id="termText"></p>
    <button class="close-modal" onclick="closeTermModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–∏–Ω–∞–ª–∞ -->
<div id="resultModal" class="modal" style="display: none;">
  <div class="modal-content result-screen" id="resultContent"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ß—Ç–æ –µ—Å–ª–∏" -->
<div id="whatIfModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 600px;" id="whatIfContent"></div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏ -->
<div id="eventModal" class="modal" style="display: none;">
  <div class="modal-content" style="text-align: center;" id="eventContent"></div>
</div>

<!-- –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç -->
<div class="assistant">
  <img src="assets/images/assistant.png" class="assistant-img" alt="–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç" onerror="this.style.display='none'">
  <div class="assistant-bubble" id="assistantMessage">
    –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π. –Ø –±—É–¥—É –¥–∞–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏!
  </div>
</div>

<script>
  // ============================================
  // –ù–ê–°–¢–†–û–ô–ö–ò –ó–í–£–ö–ê –ò –ì–û–õ–û–°–ê
  // ============================================
  let soundEnabled = true;
  let musicEnabled = true;
  let voiceEnabled = true;
  let volume = 50;
  let audioInitialized = false;
  let currentVoice = null;
  let hasGreeted = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è

  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
  document.body.addEventListener('click', function initAudio() {
    if (!audioInitialized) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      ctx.resume();
      audioInitialized = true;
      if (musicEnabled) {
        const music = document.getElementById('bgMusic');
        music.volume = volume / 100 * 0.2;
        music.play().catch(e => {});
      }
      document.body.removeEventListener('click', initAudio);
    }
  }, { once: true });

  function playSound(soundId) {
    if (!soundEnabled) return;
    const sound = document.getElementById(soundId);
    if (sound) {
      sound.currentTime = 0;
      sound.volume = volume / 100;
      sound.play().catch(e => {});
    }
  }

  function playVoice(phraseNumber) {
    if (!voiceEnabled) return;
    
    if (currentVoice) {
      currentVoice.pause();
      currentVoice.currentTime = 0;
    }
    
    currentVoice = new Audio(`assets/sounds/voice/voice${phraseNumber}.mp3`);
    currentVoice.volume = volume / 100;
    currentVoice.play().catch(e => console.log('–ì–æ–ª–æ—Å –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è:', e));
  }

  // –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
  function toggleSettings() {
    const menu = document.getElementById('settingsMenu');
    menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    playSound('soundButton');
  }

  document.addEventListener('click', function(e) {
    const menu = document.getElementById('settingsMenu');
    const btn = document.querySelector('.settings-btn');
    if (!btn.contains(e.target) && !menu.contains(e.target)) {
      menu.style.display = 'none';
    }
  });

  function toggleSound() {
    soundEnabled = document.getElementById('soundToggle').checked;
    playSound('soundButton');
  }

  function toggleMusic() {
    musicEnabled = document.getElementById('musicToggle').checked;
    const music = document.getElementById('bgMusic');
    if (musicEnabled) {
      music.volume = volume / 100 * 0.2;
      music.play().catch(e => {});
    } else {
      music.pause();
    }
    playSound('soundButton');
  }

  function toggleVoice() {
    voiceEnabled = document.getElementById('voiceToggle').checked;
    playSound('soundButton');
  }

  function changeVolume(val) {
    volume = val;
    const music = document.getElementById('bgMusic');
    if (musicEnabled) {
      music.volume = volume / 100 * 0.2;
    }
  }

  // ============================================
  // –°–õ–û–í–ê–†–¨ –¢–ï–†–ú–ò–ù–û–í
  // ============================================
  const dictionary = {
    inflation: {
      title: '–ò–Ω—Ñ–ª—è—Ü–∏—è',
      text: '–†–æ—Å—Ç —Ü–µ–Ω. –ï—Å–ª–∏ –∏–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—Å–æ–∫–∞—è, –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Ö–æ–¥–æ–≤. –î–∞–∂–µ —Å –Ω–∏–∑–∫–æ–π —Å—Ç–∞–≤–∫–æ–π –∏–ø–æ—Ç–µ–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø–æ–¥—ä—ë–º–Ω–æ–π.'
    },
    keyRate: {
      title: '–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞',
      text: '–ü—Ä–æ—Ü–µ–Ω—Ç, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –¶–µ–Ω—Ç—Ä–æ–±–∞–Ω–∫ –¥–∞—ë—Ç –∫—Ä–µ–¥–∏—Ç—ã –±–∞–Ω–∫–∞–º. –í–ª–∏—è–µ—Ç –Ω–∞ –∏–ø–æ—Ç–µ–∫—É, –Ω–æ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Ü–µ–Ω—ã.'
    },
    gdp: {
      title: '–í–í–ü',
      text: '–†–æ—Å—Ç —ç–∫–æ–Ω–æ–º–∏–∫–∏. –í–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Ö–æ–¥—ã –ª—é–¥–µ–π. –ß–µ–º –≤—ã—à–µ –í–í–ü, —Ç–µ–º –±–æ–ª—å—à–µ –ª—é–¥–∏ –º–æ–≥—É—Ç –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –Ω–∞ –∂–∏–ª—å—ë.'
    },
    housing: {
      title: '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è',
      text: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ —Å–µ–º—å–µ –∫—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ü–µ–Ω, –¥–æ—Ö–æ–¥–æ–≤ –∏ –∏–ø–æ—Ç–µ–∫–∏. –≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å!'
    }
  };

  // ============================================
  // –°–¢–ò–õ–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø
  // ============================================
  const leadershipStyles = {
    conservative: { name: '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–æ—Ä', trustBonus: 15, businessModifier: 0.7, inflationResistance: 10 },
    reformer: { name: '–†–µ—Ñ–æ—Ä–º–∞—Ç–æ—Ä', trustBonus: -10, businessModifier: 1.4, inflationResistance: -5 },
    populist: { name: '–ù–∞—Ä–æ–¥–Ω—ã–π –ª–∏–¥–µ—Ä', trustBonus: 20, businessModifier: 0.5, inflationResistance: -10 },
    technocrat: { name: '–¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç', trustBonus: 5, businessModifier: 1.0, inflationResistance: 5 }
  };

  // ============================================
  // –°–õ–£–ß–ê–ô–ù–´–ï –°–û–ë–´–¢–ò–Ø (14 —à—Ç, 70% —Ö–æ—Ä–æ—à–∏—Ö)
  // ============================================
  const events = [
    { icon: 'üõ¢Ô∏è', name: '–†–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å', text: '–ù–µ—Ñ—Ç—å –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∞, —Ä—É–±–ª—å —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è', type: 'positive',
      inflation: -3, gdp: +2, trust: +1 },
    { icon: 'üè≠', name: '–ù–æ–≤—ã–π –∑–∞–≤–æ–¥', text: '–û—Ç–∫—Ä—ã–ª–æ—Å—å –∫—Ä—É–ø–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', type: 'positive',
      gdp: +3, housing: +2, trust: +3 },
    { icon: 'üèóÔ∏è', name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –±—É–º', text: '–í–≤–µ–¥–µ–Ω–æ —Ä–µ–∫–æ—Ä–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–ª—å—è', type: 'positive',
      housing: +8, gdp: +2 },
    { icon: 'üìä', name: '–†–æ—Å—Ç –¥–æ—Ö–æ–¥–æ–≤', text: '–†–µ–∞–ª—å–Ω—ã–µ –¥–æ—Ö–æ–¥—ã –Ω–∞—Å–µ–ª–µ–Ω–∏—è –≤—ã—Ä–æ—Å–ª–∏', type: 'positive',
      housing: +4, trust: +5 },
    { icon: 'üè†', name: '–õ—å–≥–æ—Ç–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞', text: '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ —Å—É–±—Å–∏–¥–∏—Ä—É–µ—Ç –∏–ø–æ—Ç–µ–∫—É', type: 'positive',
      housing: +5, inflation: +2 },
    { icon: 'ü§ù', name: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', text: '–ö—Ä—É–ø–Ω—ã–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', type: 'positive',
      gdp: +3, housing: +2, trust: +2 },
    { icon: 'üå±', name: '–†–µ–∫–æ—Ä–¥–Ω—ã–π —É—Ä–æ–∂–∞–π', text: '–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ –ø—Ä–æ—Ü–≤–µ—Ç–∞–µ—Ç', type: 'positive',
      inflation: -4, gdp: +2, trust: +3 },
    { icon: 'üè•', name: '–†–æ—Å—Ç –∑–∞—Ä–ø–ª–∞—Ç', text: '–ë—é–¥–∂–µ—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ', type: 'positive',
      housing: +3, trust: +4 },
    { icon: 'üíº', name: '–ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å —Ä–∞—Å—Ç—ë—Ç', text: '–û—Ç–∫—Ä—ã–ª–æ—Å—å –º–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π', type: 'positive',
      gdp: +2, housing: +2, trust: +3 },
    { icon: 'üîß', name: '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ä—ã–≤', text: '–ù–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏', type: 'positive',
      gdp: +4, inflation: -2, trust: +2 },
    
    { icon: 'üåæ', name: '–ù–µ—É—Ä–æ–∂–∞–π', text: '–ó–∞—Å—É—Ö–∞ –ø—Ä–∏–≤–µ–ª–∞ –∫ —Ä–æ—Å—Ç—É —Ü–µ–Ω –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã', type: 'negative', 
      inflation: +5, gdp: -1, trust: -2 },
    { icon: 'üåç', name: '–°–∞–Ω–∫—Ü–∏–∏', text: '–ù–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–π —Ç–æ—Ä–≥–æ–≤–ª–∏', type: 'negative',
      inflation: +3, gdp: -2, housing: -1, trust: -3 },
    { icon: 'üè¶', name: '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å', text: '–ù–µ—Å–∫–æ–ª—å–∫–æ –±–∞–Ω–∫–æ–≤ –Ω–∞ –≥—Ä–∞–Ω–∏ –∫—Ä–∞—Ö–∞', type: 'negative',
      inflation: +2, gdp: -3, trust: -6 },
    { icon: 'üíº', name: '–û—Ç—Ç–æ–∫ –∫–∞–ø–∏—Ç–∞–ª–∞', text: '–ò–Ω–≤–µ—Å—Ç–æ—Ä—ã –≤—ã–≤–æ–¥—è—Ç –¥–µ–Ω—å–≥–∏', type: 'negative',
      inflation: +2, gdp: -2, trust: -4 }
  ];

  // ============================================
  // –°–¶–ï–ù–ê–†–ò–ò (–†–ï–ê–õ–¨–ù–´–ï –ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï + –°–í–û–ë–û–î–ù–ê–Ø –ò–ì–†–ê)
  // ============================================
  const scenarios = {
    'ussr': {
      name: '–°–°–°–† 1985',
      wiki: 'https://ru.wikipedia.org/wiki/–ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞',
      startYear: 1985,
      initial: { inflation: 5, keyRate: 4, gdp: 1.5, housing: 65 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 10%, –∂–∏–ª—å—ë > 60',
      targetInflation: 10,
      targetHousing: 60,
      description: '–î–µ—Ä–∂–∏—Ç–µ —Å—Ç–∞–≤–∫—É —á—É—Ç—å –≤—ã—à–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏.',
      historicalFact: '–í –°–°–°–† –±—ã–ª–∞ —Å–∫—Ä—ã—Ç–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è. –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –Ω–µ —Ä–æ—Å–ª–∏, –Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –±—ã–ª–æ.',
      icon: 'üèõÔ∏è'
    },
    'russia90': {
      name: '–†–æ—Å—Å–∏—è 1992',
      wiki: 'https://ru.wikipedia.org/wiki/–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ_—Ä–µ—Ñ–æ—Ä–º—ã_–≤_–†–æ—Å—Å–∏–∏_(1990-–µ_–≥–æ–¥—ã)',
      startYear: 1992,
      initial: { inflation: 2508, keyRate: 100, gdp: -14.5, housing: 8 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 300%, –∂–∏–ª—å—ë > 12',
      targetInflation: 300,
      targetHousing: 12,
      description: '–ì–∏–ø–µ—Ä–∏–Ω—Ñ–ª—è—Ü–∏—è. –ü–æ–¥–Ω–∏–º–∏—Ç–µ —Å—Ç–∞–≤–∫—É –≤—ã—à–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏.',
      historicalFact: '–í 1992 –≥–æ–¥—É —Ü–µ–Ω—ã –≤—ã—Ä–æ—Å–ª–∏ –≤ 26 —Ä–∞–∑ (–∏–Ω—Ñ–ª—è—Ü–∏—è 2508%)! –ö–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∏ —Ç–∞–∫, —á—Ç–æ —Å—Ç–∞–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.',
      icon: 'üî•'
    },
    'russia98': {
      name: '–†–æ—Å—Å–∏—è 1998',
      wiki: 'https://ru.wikipedia.org/wiki/–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π_–∫—Ä–∏–∑–∏—Å_–≤_–†–æ—Å—Å–∏–∏_(1998)',
      startYear: 1998,
      initial: { inflation: 84, keyRate: 60, gdp: -5.3, housing: 8 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 30%, –∂–∏–ª—å—ë > 15',
      targetInflation: 30,
      targetHousing: 15,
      description: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ—Ñ–æ–ª—Ç–∞.',
      historicalFact: '–ü–æ—Å–ª–µ –¥–µ—Ñ–æ–ª—Ç–∞ 1998 –≥–æ–¥–∞ –∏–Ω—Ñ–ª—è—Ü–∏—è –ø–æ–¥—Å–∫–æ—á–∏–ª–∞ –¥–æ 84%, –Ω–æ –∑–∞—Ç–µ–º —Å–Ω–∏–∂–∞–ª–∞—Å—å.',
      icon: 'üìâ'
    },
    'russia00': {
      name: '–†–æ—Å—Å–∏—è 2000',
      wiki: 'https://ru.wikipedia.org/wiki/–≠–∫–æ–Ω–æ–º–∏–∫–∞_–†–æ—Å—Å–∏–∏_–≤_2000-—Ö',
      startYear: 2000,
      initial: { inflation: 20.2, keyRate: 25, gdp: 10.0, housing: 22 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 12%, –∂–∏–ª—å—ë > 35',
      targetInflation: 12,
      targetHousing: 35,
      description: '–°—Ç–∞–≤–∫–∞ –≤—ã—à–µ –∏–Ω—Ñ–ª—è—Ü–∏–∏. –ú–æ–∂–Ω–æ —Å–Ω–∏–∂–∞—Ç—å.',
      historicalFact: '2000-–µ: –Ω–µ—Ñ—Ç—å —Ä–æ—Å–ª–∞, –¥–æ—Ö–æ–¥—ã —É–≤–µ–ª–∏—á–∏–≤–∞–ª–∏—Å—å, –∂–∏–ª—å—ë —Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –¥–æ—Å—Ç—É–ø–Ω–µ–µ.',
      icon: 'üìà'
    },
    'russia08': {
      name: '–†–æ—Å—Å–∏—è 2008',
      wiki: 'https://ru.wikipedia.org/wiki/–ú–∏—Ä–æ–≤–æ–π_—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π_–∫—Ä–∏–∑–∏—Å_(2008)',
      startYear: 2008,
      initial: { inflation: 14.1, keyRate: 13, gdp: 5.2, housing: 35 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 8%, –∂–∏–ª—å—ë > 45',
      targetInflation: 8,
      targetHousing: 45,
      description: '–ú–∏—Ä–æ–≤–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫—Ä–∏–∑–∏—Å.',
      historicalFact: '–í 2008 –≥–æ–¥—É –∏–Ω—Ñ–ª—è—Ü–∏—è –¥–æ—Å—Ç–∏–≥–ª–∞ 14,1%, –¶–ë –ø–æ–≤—ã—à–∞–ª —Å—Ç–∞–≤–∫—É.',
      icon: 'üåç'
    },
    'russia14': {
      name: '–†–æ—Å—Å–∏—è 2014',
      wiki: 'https://ru.wikipedia.org/wiki/–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π_–∫—Ä–∏–∑–∏—Å_–≤_–†–æ—Å—Å–∏–∏_(2014‚Äî2015)',
      startYear: 2014,
      initial: { inflation: 11.4, keyRate: 17, gdp: 0.7, housing: 45 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 7%, –∂–∏–ª—å—ë > 50',
      targetInflation: 7,
      targetHousing: 50,
      description: '–°–∞–Ω–∫—Ü–∏–∏ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è.',
      historicalFact: '2014: —Å–∞–Ω–∫—Ü–∏–∏, –æ–±–≤–∞–ª —Ä—É–±–ª—è. –¶–ë –ø–æ–¥–Ω—è–ª —Å—Ç–∞–≤–∫—É –¥–æ 17%, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ —Ä—É–±–ª—å.',
      icon: 'üîí'
    },
    'russia22': {
      name: '–†–æ—Å—Å–∏—è 2022',
      wiki: 'https://ru.wikipedia.org/wiki/–°–∞–Ω–∫—Ü–∏–∏_–ø—Ä–æ—Ç–∏–≤_–†–æ—Å—Å–∏–∏_(2022)',
      startYear: 2022,
      initial: { inflation: 11.9, keyRate: 20, gdp: -1.2, housing: 48 },
      goal: '–¶–µ–ª—å: –∏–Ω—Ñ–ª—è—Ü–∏—è < 8%, –∂–∏–ª—å—ë > 50',
      targetInflation: 8,
      targetHousing: 50,
      description: '–î–µ—Ä–∂–∏—Ç–µ —Å—Ç–∞–≤–∫—É –≤—ã—Å–æ–∫–æ–π –ø–µ—Ä–≤—ã–π –≥–æ–¥.',
      historicalFact: '2022: –Ω–æ–≤—ã–µ —Å–∞–Ω–∫—Ü–∏–∏, —Å—Ç–∞–≤–∫–∞ 20%, –Ω–æ —ç–∫–æ–Ω–æ–º–∏–∫–∞ –≤—ã—Å—Ç–æ—è–ª–∞.',
      icon: '‚ö°'
    },
    'sandbox': {
      name: 'üß™ –°–≤–æ–±–æ–¥–Ω–∞—è –∏–≥—Ä–∞',
      wiki: '#',
      startYear: 2024,
      initial: { inflation: 7, keyRate: 10, gdp: 2, housing: 50, trust: 50 },
      goal: '–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–µ–∑ —Ü–µ–ª–µ–π',
      targetInflation: 999,
      targetHousing: 0,
      description: '–ü—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.',
      historicalFact: '–ó–¥–µ—Å—å –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ —ç–∫–æ–Ω–æ–º–∏–∫–∞.',
      icon: 'üß™'
    }
  };

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
  let currentScenario = 'ussr';
  let currentMeeting = 0;
  let totalMeetings = 0;
  let gameState = {
    inflation: [],
    keyRate: [],
    gdp: [],
    housing: [],
    trust: [],
    apartmentPrice: [],
    income: []
  };
  let gameFinished = false;
  let chart;
  let currentStyle = null;

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤–∞ "–ª–µ—Ç"
  function pluralizeYears(years) {
    const num = Math.floor(years);
    const lastDigit = num % 10;
    const lastTwoDigits = num % 100;
    if (lastTwoDigits >= 11 && lastTwoDigits <= 14) return '–ª–µ—Ç';
    if (lastDigit === 1) return '–≥–æ–¥';
    if (lastDigit >= 2 && lastDigit <= 4) return '–≥–æ–¥–∞';
    return '–ª–µ—Ç';
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª—è
  function loadStyle() {
    const styleId = localStorage.getItem('leadershipStyle') || 'technocrat';
    currentStyle = leadershipStyles[styleId];
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
  function loadScenario(scenarioId) {
    currentScenario = scenarioId;
    const s = scenarios[scenarioId];
    currentMeeting = 0;
    
    const baseApartmentPrice = scenarioId === 'ussr' ? 20 :
                               scenarioId === 'russia90' ? 0.5 :
                               scenarioId === 'russia98' ? 0.6 :
                               scenarioId === 'russia00' ? 1.5 :
                               scenarioId === 'russia08' ? 3.5 :
                               scenarioId === 'russia14' ? 4.5 :
                               scenarioId === 'russia22' ? 7.2 : 10;
    
    const baseIncome = scenarioId === 'ussr' ? 150 :
                       scenarioId === 'russia90' ? 20 :
                       scenarioId === 'russia98' ? 25 :
                       scenarioId === 'russia00' ? 8 :
                       scenarioId === 'russia08' ? 30 :
                       scenarioId === 'russia14' ? 45 :
                       scenarioId === 'russia22' ? 70 : 80;
    
    gameState = {
      inflation: [s.initial.inflation],
      keyRate: [s.initial.keyRate],
      gdp: [s.initial.gdp * (currentStyle?.businessModifier || 1.0)],
      housing: [s.initial.housing],
      trust: [50 + (currentStyle?.trustBonus || 0)],
      apartmentPrice: [baseApartmentPrice],
      income: [baseIncome]
    };
    
    gameFinished = false;

    document.getElementById('wikiLinkA').href = s.wiki;
    document.getElementById('wikiLinkA').textContent = `üìñ ${s.name}`;
    
    if (scenarioId === 'sandbox') {
      document.getElementById('scenarioGoal').innerHTML = `<span class="goal-text">üß™ –°–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º. –ù–µ—Ç —Ü–µ–ª–µ–π, —Ç–æ–ª—å–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.</span>`;
    } else {
      document.getElementById('scenarioGoal').innerHTML = `<span class="goal-text">üéØ ${s.goal}</span>`;
    }

    updateUI();
    updateForecast();
    updateAssistantBasedOnSituation();
    
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é
    if (!hasGreeted) {
      playVoice(1);
      hasGreeted = true;
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ü–µ–Ω—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –∏ –¥–æ—Ö–æ–¥–æ–≤
  function calculateApartmentPrice(inflation, prevPrice, prevIncome, gdp) {
    const priceGrowth = inflation * 0.5;
    const newPrice = prevPrice * (1 + priceGrowth / 100);
    const incomeGrowth = Math.max(0, gdp * 0.8);
    const newIncome = prevIncome * (1 + incomeGrowth / 100);
    return { price: newPrice, income: newIncome };
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  function updateUI() {
    if (gameFinished) {
      showResult();
      return;
    }

    const s = scenarios[currentScenario];
    const yearOffset = Math.floor(currentMeeting / 4);
    const quarterNum = (currentMeeting % 4) + 1;
    const currentRealYear = s.startYear + yearOffset;
    
    document.getElementById('meetingDisplay').textContent = `${currentMeeting+1}/16`;
    document.getElementById('yearDisplay').textContent = currentRealYear;
    
    const quarters = ['I', 'II', 'III', 'IV'];
    document.getElementById('quarterDisplay').textContent = quarters[quarterNum-1] + ' –∫–≤–∞—Ä—Ç–∞–ª';

    const infl = gameState.inflation[currentMeeting];
    const rate = gameState.keyRate[currentMeeting];
    const gdp = gameState.gdp[currentMeeting];
    const house = gameState.housing[currentMeeting];
    const trust = gameState.trust[currentMeeting];
    const realRate = (rate - infl).toFixed(1);
    
    const apartmentPrice = gameState.apartmentPrice[currentMeeting];
    const income = gameState.income[currentMeeting];
    const years = apartmentPrice * 1000 / income / 12;

    document.getElementById('trustFill').style.width = trust + '%';
    document.getElementById('trustValue').textContent = trust + '%';

    const inflCritical = (currentScenario !== 'sandbox' && infl > s.targetInflation * 1.5) ? 'critical' : (currentScenario !== 'sandbox' && infl <= s.targetInflation ? 'good' : '');
    const houseCritical = (currentScenario !== 'sandbox' && house < s.targetHousing * 0.7) ? 'critical' : (currentScenario !== 'sandbox' && house >= s.targetHousing ? 'good' : '');
    const realRateCritical = realRate < 0 ? 'critical' : (realRate > 5 ? 'good' : '');

    const metricsHtml = `
      <div class="metric-card ${inflCritical}">
        <div class="metric-header">
          <span class="metric-name">üìà –ò–Ω—Ñ–ª—è—Ü–∏—è</span>
          <span class="help-icon" onclick="showTerm('inflation')">‚ìò</span>
        </div>
        <div class="metric-value">${infl.toFixed(1)}%</div>
        <div class="metric-detail">‚¨ÜÔ∏è –¶–µ–Ω—ã —Ä–∞—Å—Ç—É—Ç</div>
      </div>
      <div class="metric-card ${realRateCritical}">
        <div class="metric-header">
          <span class="metric-name">üí∞ –ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞</span>
          <span class="help-icon" onclick="showTerm('keyRate')">‚ìò</span>
        </div>
        <div class="metric-value">${rate.toFixed(1)}%</div>
        <div class="real-rate">–†–µ–∞–ª—å–Ω–∞—è: ${realRate}%</div>
        <div class="metric-detail">${realRate < 0 ? '‚ö†Ô∏è –î–µ–Ω—å–≥–∏ —Ç–∞—é—Ç' : realRate > 5 ? '‚úÖ –î–µ–Ω—å–≥–∏ –∑–∞—â–∏—â–µ–Ω—ã' : ''}</div>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <span class="metric-name">üè≠ –í–í–ü</span>
          <span class="help-icon" onclick="showTerm('gdp')">‚ìò</span>
        </div>
        <div class="metric-value">${gdp > 0 ? '+' : ''}${gdp.toFixed(1)}%</div>
        <div class="metric-detail">üí∞ –î–æ—Ö–æ–¥—ã: ${income.toFixed(0)} —Ç—ã—Å.‚ÇΩ/–º–µ—Å</div>
      </div>
      <div class="metric-card ${houseCritical}">
        <div class="metric-header">
          <span class="metric-name">üè† –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è</span>
          <span class="help-icon" onclick="showTerm('housing')">‚ìò</span>
        </div>
        <div class="metric-value">${house.toFixed(0)}/100</div>
        <div class="metric-detail">üè¢ –ö–≤–∞—Ä—Ç–∏—Ä–∞: ${apartmentPrice.toFixed(1)} –º–ª–Ω ‚ÇΩ</div>
        <div class="metric-detail">üìä –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: ${years.toFixed(1)} ${pluralizeYears(years)} –¥–æ—Ö–æ–¥–∞</div>
      </div>
    `;
    document.getElementById('metricsGrid').innerHTML = metricsHtml;
    
    showHints();

    const slider = document.getElementById('keyRateSlider');
    slider.value = rate;
    document.getElementById('rateDisplay').textContent = rate.toFixed(1) + '%';

    renderChart();
  }

  function getHint(metric, value, rate) {
    const s = scenarios[currentScenario];
    if (currentScenario === 'sandbox') {
      switch(metric) {
        case 'inflation':
          return value > 10 ? 'üìà –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—Å–æ–∫–∞—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–Ω—è—Ç—å —Å—Ç–∞–≤–∫—É.' : '‚úÖ –ò–Ω—Ñ–ª—è—Ü–∏—è –Ω–∏–∑–∫–∞—è. –ú–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.';
        case 'keyRate':
          const real = value - gameState.inflation[currentMeeting];
          return real < 0 ? '‚ö†Ô∏è –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è.' : '‚úÖ –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è.';
        case 'gdp':
          return value > 0 ? 'üìà –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Ä–∞—Å—Ç—ë—Ç.' : 'üìâ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –ø–∞–¥–∞–µ—Ç.';
        case 'housing':
          return value > 50 ? 'üè† –ñ–∏–ª—å—ë –≤–ø–æ–ª–Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ.' : 'üèöÔ∏è –ñ–∏–ª—å—ë –º–∞–ª–æ–¥–æ—Å—Ç—É–ø–Ω–æ.';
        default: return '';
      }
    }
    switch(metric) {
      case 'inflation':
        if (value > s.targetInflation * 1.5) return 'üî• –ò–Ω—Ñ–ª—è—Ü–∏—è —Å—ä–µ–¥–∞–µ—Ç –¥–æ—Ö–æ–¥—ã! –ö–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ. –ú–∏—Ñ —Ä—É—à–∏—Ç—Å—è.';
        if (value > s.targetInflation) return '‚ö†Ô∏è –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—à–µ —Ü–µ–ª–∏. –¶–µ–Ω—ã –Ω–∞ –∂–∏–ª—å—ë —Ä–∞—Å—Ç—É—Ç.';
        return '‚úÖ –ò–Ω—Ñ–ª—è—Ü–∏—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º. –•–æ—Ä–æ—à–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∂–∏–ª—å—è.';
      case 'keyRate':
        const real = value - gameState.inflation[currentMeeting];
        if (real < -5) return '‚ö†Ô∏è –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ —Å–∏–ª—å–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è! –î–µ–Ω—å–≥–∏ —Ç–∞—é—Ç, –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–∞—é—Ç. –ú–∏—Ñ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!';
        if (real < 0) return '‚ö†Ô∏è –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è. –õ—é–¥–∏ –±–µ–≥—É—Ç –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, —Ü–µ–Ω—ã —Ä–∞—Å—Ç—É—Ç.';
        if (real > 10) return 'üí™ –°—Ç–∞–≤–∫–∞ –≤—ã—Å–æ–∫–∞—è, –∏–Ω—Ñ–ª—è—Ü–∏—è –ø–∞–¥–∞–µ—Ç. –•–æ—Ä–æ—à–æ –¥–ª—è —Ü–µ–Ω –Ω–∞ –∂–∏–ª—å—ë.';
        return '‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏–Ω—Ñ–ª—è—Ü–∏–µ–π.';
      case 'gdp':
        if (value < -5) return 'üìâ –ö—Ä–∏–∑–∏—Å! –î–æ—Ö–æ–¥—ã –ø–∞–¥–∞—é—Ç, –∂–∏–ª—å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ–µ.';
        if (value < 0) return 'üìâ –°–ø–∞–¥. –î–æ—Ö–æ–¥—ã –Ω–µ —Ä–∞—Å—Ç—É—Ç.';
        return 'üìà –†–æ—Å—Ç. –î–æ—Ö–æ–¥—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è, —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–∫—É–ø–∞—Ç—å –∂–∏–ª—å—ë.';
      case 'housing':
        if (value < s.targetHousing - 10) return 'üèöÔ∏è –ñ–∏–ª—å—ë –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ú–∏—Ñ –æ–ø—Ä–æ–≤–µ—Ä–≥–∞–µ—Ç—Å—è: —Å—Ç–∞–≤–∫–∞ –Ω–∏–∑–∫–∞—è, –Ω–æ –∫—É–ø–∏—Ç—å –Ω–µ–ª—å–∑—è.';
        if (value < s.targetHousing) return 'üè† –ù–∏–∂–µ —Ü–µ–ª–∏. –ù—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –∏–Ω—Ñ–ª—è—Ü–∏–µ–π.';
        return 'üèòÔ∏è –î–æ—Å—Ç—É–ø–Ω–æ! –ë–∞–ª–∞–Ω—Å –Ω–∞–π–¥–µ–Ω.';
      default: return '';
    }
  }

  function showHints() {
    ['inflation', 'keyRate', 'gdp', 'housing'].forEach(m => {
      const el = document.getElementById(`hint-${m}`);
      if (el) el.classList.add('show');
    });
  }

  function updateForecast() {
    const slider = document.getElementById('keyRateSlider');
    const newRate = parseFloat(slider.value);
    const currentInfl = gameState.inflation[currentMeeting];
    const forecastInfl = Math.max(3, currentInfl - (newRate - 10) * 1.2);
    document.getElementById('forecastText').innerHTML = `–∏–Ω—Ñ–ª—è—Ü–∏—è ‚âà ${forecastInfl.toFixed(1)}%`;
  }

  function renderChart() {
    const ctx = document.getElementById('economyChart').getContext('2d');
    const s = scenarios[currentScenario];
    
    const labels = [];
    for (let i = 0; i <= currentMeeting; i++) {
      const year = s.startYear + Math.floor(i / 4);
      const quarter = (i % 4) + 1;
      labels.push(`${year} Q${quarter}`);
    }

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          { label: '–ò–Ω—Ñ–ª—è—Ü–∏—è', data: gameState.inflation.slice(0, currentMeeting+1), backgroundColor: '#ff6384' },
          { label: '–°—Ç–∞–≤–∫–∞', data: gameState.keyRate.slice(0, currentMeeting+1), backgroundColor: '#36a2eb' },
          { label: '–í–í–ü', data: gameState.gdp.slice(0, currentMeeting+1), backgroundColor: '#4caf50' },
          { label: '–ñ–∏–ª—å—ë', data: gameState.housing.slice(0, currentMeeting+1), backgroundColor: '#ffcd56' }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: 'white' } },
                 x: { ticks: { color: 'white', maxRotation: 45 } } },
        plugins: { legend: { display: false } }
      }
    });
  }

  // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ (30%)
  function triggerRandomEvent() {
    if (Math.random() > 0.3) return;

    const event = events[Math.floor(Math.random() * events.length)];
    
    const lastIdx = gameState.inflation.length - 1;
    
    if (event.inflation) gameState.inflation[lastIdx] = Math.max(3, Math.min(300, gameState.inflation[lastIdx] + event.inflation));
    if (event.gdp) gameState.gdp[lastIdx] = Math.max(-20, Math.min(15, gameState.gdp[lastIdx] + event.gdp));
    if (event.housing) gameState.housing[lastIdx] = Math.max(0, Math.min(100, gameState.housing[lastIdx] + event.housing));
    if (event.trust) gameState.trust[lastIdx] = Math.max(0, Math.min(100, gameState.trust[lastIdx] + event.trust));

    const priceData = calculateApartmentPrice(
      gameState.inflation[lastIdx], 
      gameState.apartmentPrice[lastIdx], 
      gameState.income[lastIdx],
      gameState.gdp[lastIdx]
    );
    gameState.apartmentPrice[lastIdx] = priceData.price;
    gameState.income[lastIdx] = priceData.income;

    let eventHtml = `
      <div style="font-size:64px; margin-bottom:20px;">${event.icon}</div>
      <h2 style="color: ${event.type === 'positive' ? '#4caf50' : '#ff6b4a'}">${event.name}</h2>
      <p style="margin:20px 0; font-size:18px;">${event.text}</p>
    `;
    
    if (event.name === '–°–∞–Ω–∫—Ü–∏–∏') {
      eventHtml += `<p style="font-style:italic; color:#ffd966;">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç: —Å–∞–Ω–∫—Ü–∏–∏ 2014 –∏ 2022 –≥–æ–¥–æ–≤ –∑–∞—Å—Ç–∞–≤–ª—è–ª–∏ –¶–ë –ø–æ–≤—ã—à–∞—Ç—å —Å—Ç–∞–≤–∫—É</p>`;
    } else if (event.name === '–ù–µ—É—Ä–æ–∂–∞–π') {
      eventHtml += `<p style="font-style:italic; color:#ffd966;">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç: –Ω–µ—É—Ä–æ–∂–∞–π 2010 –≥–æ–¥–∞ —Ä–∞–∑–æ–≥–Ω–∞–ª –∏–Ω—Ñ–ª—è—Ü–∏—é –¥–æ 8,8%</p>`;
    } else if (event.name === '–†–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å') {
      eventHtml += `<p style="font-style:italic; color:#ffd966;">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç: –≤ 2000-—Ö –Ω–µ—Ñ—Ç—å –ø–æ 140$ –ø–æ–º–æ–≥–ª–∞ —Ä–æ—Å—Ç—É –¥–æ—Ö–æ–¥–æ–≤</p>`;
    }
    
    if (event.type === 'negative') {
      eventHtml += `
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="close-modal" onclick="closeEvent()">–ü–æ–Ω—è—Ç–Ω–æ</button>
          <button class="primary-btn" onclick="emergencyMeeting()" style="background: #b22222;">üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ</button>
        </div>
      `;
      playVoice(16);
    } else {
      eventHtml += `<button class="close-modal" onclick="closeEvent()">–ü–æ–Ω—è—Ç–Ω–æ</button>`;
    }
    
    document.getElementById('eventContent').innerHTML = eventHtml;
    document.getElementById('eventModal').style.display = 'flex';
    
    playSound(event.type === 'positive' ? 'soundOvation' : 'soundNoise');
    updateUI();
  }

  function emergencyMeeting() {
    document.getElementById('eventModal').style.display = 'none';
    
    playSound('soundBell');
    playVoice(13);
    
    const currentRate = gameState.keyRate[currentMeeting];
    
    const emergencyHtml = `
      <div style="text-align: center;">
        <div style="font-size:64px; margin-bottom:20px;">üö®</div>
        <h2 style="color: #ff6b4a;">–≠–ö–°–¢–†–ï–ù–ù–û–ï –ó–ê–°–ï–î–ê–ù–ò–ï</h2>
        <p style="margin:20px 0;">–ò–∑–º–µ–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</p>
        <div style="margin: 30px 0;">
          <p style="margin-bottom:10px;">–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞: ${currentRate.toFixed(1)}%</p>
          <p>–ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: <span id="emergencyRate" style="font-size:32px; color:#ffd966;">${currentRate.toFixed(1)}%</span></p>
          <input type="range" id="emergencySlider" min="0" max="200" value="${currentRate}" step="0.5" style="width:100%; margin:20px 0;">
        </div>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="close-modal" onclick="closeEmergency()">–û—Ç–ª–æ–∂–∏—Ç—å</button>
          <button class="primary-btn" onclick="applyEmergencyDecision()" style="background: #b22222;">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
      </div>
    `;
    
    document.getElementById('eventContent').innerHTML = emergencyHtml;
    document.getElementById('eventModal').style.display = 'flex';
    
    setTimeout(() => {
      const slider = document.getElementById('emergencySlider');
      if (slider) {
        slider.addEventListener('input', function(e) {
          document.getElementById('emergencyRate').textContent = e.target.value + '%';
        });
      }
    }, 100);
  }

  function closeEmergency() {
    document.getElementById('eventModal').style.display = 'none';
    playVoice(4);
  }

  function applyEmergencyDecision() {
    const newRate = parseFloat(document.getElementById('emergencySlider').value);
    
    gameState.keyRate[currentMeeting] = newRate;
    
    document.getElementById('eventModal').style.display = 'none';
    playSound('soundCash');
    playVoice(18);
    
    document.getElementById('keyRateSlider').value = newRate;
    document.getElementById('rateDisplay').textContent = newRate.toFixed(1) + '%';
    updateUI();
    updateForecast();
    updateAssistantBasedOnSituation();
  }

  function closeEvent() {
    document.getElementById('eventModal').style.display = 'none';
  }

  // –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
  function updateAssistantBasedOnSituation() {
    const s = scenarios[currentScenario];
    const infl = gameState.inflation[currentMeeting];
    const rate = gameState.keyRate[currentMeeting];
    const house = gameState.housing[currentMeeting];
    const prevHouse = currentMeeting > 0 ? gameState.housing[currentMeeting-1] : house;
    const houseChange = house - prevHouse;
    const real = rate - infl;
    const trust = gameState.trust[currentMeeting];
    const price = gameState.apartmentPrice[currentMeeting];
    const income = gameState.income[currentMeeting];
    
    let advice = '';
    let voicePhrase = null;

    // 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏
    if (trust < 20) {
        advice = 'üî¥ –î–æ–≤–µ—Ä–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–µ! –õ—é–¥–∏ –Ω–µ –≤–µ—Ä—è—Ç –≤–∞—à–µ–π –ø–æ–ª–∏—Ç–∏–∫–µ. –°—Ä–æ—á–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ –º–µ—Ä—ã.';
        voicePhrase = 16;
    } else if (infl > 1000) {
        advice = 'üî• –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è! –°—Ä–æ—á–Ω–æ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –≤—ã—à–µ 150%!';
        voicePhrase = 6;
    } 
    // 2. –î–∏–Ω–∞–º–∏–∫–∞ –∂–∏–ª—å—è (–≤–∞–∂–Ω–æ –¥–ª—è –º–∏—Ñ–∞)
    else if (houseChange < -2) {
        advice = 'üìâ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è –ø–∞–¥–∞–µ—Ç! –≠—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏–Ω—Ñ–ª—è—Ü–∏–µ–π.';
        voicePhrase = 10;
    } else if (houseChange > 2) {
        advice = 'üìà –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è —Ä–∞—Å—Ç—ë—Ç! –í—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.';
        voicePhrase = 18;
    }
    // 3. –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞
    else if (real < -5) {
        advice = 'üî¥ –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ —Å–∏–ª—å–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è! –î–µ–Ω—å–≥–∏ —Ç–∞—é—Ç, –ª—é–¥–∏ —Å–∫—É–ø–∞—é—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, —Ü–µ–Ω—ã —Ä–∞—Å—Ç—É—Ç. –°—Ä–æ—á–Ω–æ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!';
        voicePhrase = 6;
    } else if (real < 0) {
        advice = '‚ö†Ô∏è –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è. –î–µ–Ω—å–≥–∏ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è, –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–∞—é—Ç. –≠—Ç–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.';
        voicePhrase = 3;
    } else if (real > 5 && real < 10) {
        advice = '‚úÖ –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è, —É–º–µ—Ä–µ–Ω–Ω–∞—è. –û—Ç–ª–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.';
        voicePhrase = 4;
    } else if (real >= 10) {
        advice = 'üí∞ –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –≤—ã—Å–æ–∫–∞—è. –≠–∫–æ–Ω–æ–º–∏–∫–∞ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è. –ú–æ–∂–Ω–æ –Ω–µ–º–Ω–æ–≥–æ —Å–Ω–∏–∑–∏—Ç—å –¥–ª—è —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ—Å—Ç–∞.';
        voicePhrase = 4;
    }
    // 4. –¶–µ–ª–∏
    else if (currentScenario !== 'sandbox') {
        if (house < s.targetHousing) {
            advice = `üèöÔ∏è –ñ–∏–ª—å—ë –≤—Å—ë –µ—â—ë –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ß—Ç–æ–±—ã –µ–≥–æ –ø–æ–≤—ã—Å–∏—Ç—å, –Ω—É–∂–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞. –°–µ–π—á–∞—Å —Ü–µ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã ${price.toFixed(1)} –º–ª–Ω, –¥–æ—Ö–æ–¥ ${income.toFixed(0)} —Ç—ã—Å.`;
            voicePhrase = 10;
        } else if (infl > s.targetInflation) {
            advice = `‚ö†Ô∏è –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—à–µ —Ü–µ–ª–∏. –î–µ—Ä–∂–∏—Ç–µ —Å—Ç–∞–≤–∫—É –Ω–∞ —É—Ä–æ–≤–Ω–µ ${Math.ceil(infl + 2)}% –∏–ª–∏ –≤—ã—à–µ.`;
            voicePhrase = 7;
        } else {
            advice = '‚úÖ –¶–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.';
            voicePhrase = 4;
        }
    }
    // 5. –°–≤–æ–±–æ–¥–Ω–∞—è –∏–≥—Ä–∞ –∏–ª–∏ –æ–±—â–∏–µ —Å–æ–≤–µ—Ç—ã
    else {
        const tips = [
            '–ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π.',
            '–ü–æ–º–Ω–∏—Ç–µ: —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è.',
            '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É.',
            '–ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –¥–∏–Ω–∞–º–∏–∫–æ–π —Ü–µ–Ω –∏ –¥–æ—Ö–æ–¥–æ–≤.'
        ];
        advice = tips[Math.floor(Math.random() * tips.length)];
        voicePhrase = 4;
    }

    document.getElementById('assistantMessage').textContent = advice;
    if (voicePhrase) playVoice(voicePhrase);
  }

  // –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
  function openScenarioMenu() {
    const grid = document.getElementById('scenarioGrid');
    grid.innerHTML = '';
    
    Object.keys(scenarios).forEach(key => {
      const s = scenarios[key];
      const option = document.createElement('div');
      option.className = 'scenario-option';
      option.onclick = () => {
        playSound('soundButton');
        loadScenario(key);
        closeScenarioMenu();
      };
      option.innerHTML = `
        <h4>${s.icon} ${s.name}</h4>
        <p>${s.description}</p>
      `;
      grid.appendChild(option);
    });
    
    document.getElementById('scenarioModal').style.display = 'flex';
    playSound('soundButton');
  }

  function closeScenarioMenu() {
    document.getElementById('scenarioModal').style.display = 'none';
  }

  // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
  function applyDecision() {
    if (gameFinished) return;
    if (currentMeeting >= 15) {
      gameFinished = true;
      showResult();
      return;
    }

    const newRate = parseFloat(document.getElementById('keyRateSlider').value);
    const currentInfl = gameState.inflation[currentMeeting];
    const currentGdp = gameState.gdp[currentMeeting];
    const currentHouse = gameState.housing[currentMeeting];
    const currentTrust = gameState.trust[currentMeeting];
    const currentPrice = gameState.apartmentPrice[currentMeeting];
    const currentIncome = gameState.income[currentMeeting];

    let nextInfl = currentInfl - (newRate - 10) * 1.2 + (Math.random() * 4 - 2);
    nextInfl = Math.max(3, Math.min(300, nextInfl));

    let nextGdp = currentGdp + (10 - newRate) * 0.2 - (currentInfl > 50 ? 2 : 0);
    nextGdp = Math.max(-20, Math.min(15, nextGdp));
    nextGdp *= (currentStyle?.businessModifier || 1.0);

    let realRate = newRate - nextInfl;
    let houseChange = (8 - newRate) * 0.2 - (nextInfl / 15) + (nextGdp * 0.3);
    if (realRate < -5) houseChange -= 2;
    if (realRate > 5) houseChange += 1;
    let nextHouse = currentHouse + houseChange;
    nextHouse = Math.max(0, Math.min(100, nextHouse));

    let trustChange = 0;
    if (newRate > currentInfl) trustChange += 2;
    if (newRate < currentInfl - 10) trustChange -= 3;
    if (nextGdp > currentGdp) trustChange += 1;
    if (nextHouse < currentHouse) trustChange -= 1;

    let nextTrust = currentTrust + trustChange;
    nextTrust = Math.max(0, Math.min(100, nextTrust));

    const priceData = calculateApartmentPrice(nextInfl, currentPrice, currentIncome, nextGdp);

    gameState.keyRate.push(newRate);
    gameState.inflation.push(nextInfl);
    gameState.gdp.push(nextGdp);
    gameState.housing.push(nextHouse);
    gameState.trust.push(nextTrust);
    gameState.apartmentPrice.push(priceData.price);
    gameState.income.push(priceData.income);

    currentMeeting++;

    if (nextTrust < 15) {
      gameFinished = true;
    }

    playSound('soundCash');
    updateUI();
    updateForecast();
    updateAssistantBasedOnSituation();
    triggerRandomEvent();
    
    if (nextHouse > currentHouse && nextInfl < currentInfl) playVoice(18);
  }

  function showWhatIf() {
    const currentRate = parseFloat(document.getElementById('keyRateSlider').value);
    const currentInfl = gameState.inflation[currentMeeting];
    const currentGdp = gameState.gdp[currentMeeting];
    const currentHouse = gameState.housing[currentMeeting];
    const currentPrice = gameState.apartmentPrice[currentMeeting];
    const currentIncome = gameState.income[currentMeeting];
    
    const lowerRate = Math.max(0, currentRate - 5);
    const lowerInfl = Math.max(3, currentInfl - (lowerRate - 10) * 1.2);
    const lowerGdp = currentGdp + (10 - lowerRate) * 0.2 - (currentInfl > 50 ? 2 : 0);
    const lowerHouse = currentHouse + (10 - lowerRate) * 0.3 - (lowerInfl / 30) + (lowerGdp * 0.2);
    const lowerPrice = currentPrice * (1 + lowerInfl * 0.5 / 100);
    
    const higherRate = Math.min(200, currentRate + 5);
    const higherInfl = Math.max(3, currentInfl - (higherRate - 10) * 1.2);
    const higherGdp = currentGdp + (10 - higherRate) * 0.2 - (currentInfl > 50 ? 2 : 0);
    const higherHouse = currentHouse + (10 - higherRate) * 0.3 - (higherInfl / 30) + (higherGdp * 0.2);
    const higherPrice = currentPrice * (1 + higherInfl * 0.5 / 100);
    
    const whatIfHtml = `
      <h3 style="color:#ffd966; margin-bottom:20px;">üîÆ –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏...</h3>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
        <div style="background:rgba(255,107,74,0.2); padding:20px; border-radius:30px;">
          <h4 style="color:#ff6b4a; margin-bottom:10px;">üìâ –°–ù–ò–ó–ò–¢–¨ –°–¢–ê–í–ö–£</h4>
          <p>–°—Ç–∞–≤–∫–∞: ${lowerRate.toFixed(1)}%</p>
          <p>–ò–Ω—Ñ–ª—è—Ü–∏—è: ${lowerInfl.toFixed(1)}%</p>
          <p>–í–í–ü: ${lowerGdp > 0 ? '+' : ''}${lowerGdp.toFixed(1)}%</p>
          <p>–ñ–∏–ª—å—ë: ${Math.max(0, Math.min(100, lowerHouse)).toFixed(0)}/100</p>
          <p>–¶–µ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã: ${lowerPrice.toFixed(1)} –º–ª–Ω ‚ÇΩ</p>
          <p style="color:${lowerInfl > currentInfl ? '#ff6b4a' : '#4caf50'}">
            ${lowerInfl > currentInfl ? '‚ö†Ô∏è –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—Ä–∞—Å—Ç–µ—Ç' : '‚úÖ –ò–Ω—Ñ–ª—è—Ü–∏—è —Å–Ω–∏–∑–∏—Ç—Å—è'}
          </p>
        </div>
        
        <div style="background:rgba(76,175,80,0.2); padding:20px; border-radius:30px;">
          <h4 style="color:#4caf50; margin-bottom:10px;">üìà –ü–û–í–´–°–ò–¢–¨ –°–¢–ê–í–ö–£</h4>
          <p>–°—Ç–∞–≤–∫–∞: ${higherRate.toFixed(1)}%</p>
          <p>–ò–Ω—Ñ–ª—è—Ü–∏—è: ${higherInfl.toFixed(1)}%</p>
          <p>–í–í–ü: ${higherGdp > 0 ? '+' : ''}${higherGdp.toFixed(1)}%</p>
          <p>–ñ–∏–ª—å—ë: ${Math.max(0, Math.min(100, higherHouse)).toFixed(0)}/100</p>
          <p>–¶–µ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã: ${higherPrice.toFixed(1)} –º–ª–Ω ‚ÇΩ</p>
          <p style="color:${higherInfl < currentInfl ? '#4caf50' : '#ff6b4a'}">
            ${higherInfl < currentInfl ? '‚úÖ –ò–Ω—Ñ–ª—è—Ü–∏—è —Å–Ω–∏–∑–∏—Ç—Å—è' : '‚ö†Ô∏è –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã—Ä–∞—Å—Ç–µ—Ç'}
          </p>
        </div>
      </div>
      
      <p style="margin-top:20px; font-style:italic; color:#ffd966;">
        üí° –ì–ª–∞–≤–Ω–æ–µ: —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –±–µ–∑ —É—á—ë—Ç–∞ –∏–Ω—Ñ–ª—è—Ü–∏–∏ –¥–µ–ª–∞–µ—Ç –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥–æ—Ä–æ–∂–µ!
      </p>
      
      <button class="close-modal" onclick="closeWhatIf()" style="margin-top:20px;">–ü–æ–Ω—è—Ç–Ω–æ</button>
    `;
    
    document.getElementById('whatIfContent').innerHTML = whatIfHtml;
    document.getElementById('whatIfModal').style.display = 'flex';
    playSound('soundButton');
  }

  function closeWhatIf() {
    document.getElementById('whatIfModal').style.display = 'none';
  }

  function showResult() {
    const s = scenarios[currentScenario];
    const finalHouse = gameState.housing[15];
    const finalInfl = gameState.inflation[15];
    const finalTrust = gameState.trust[15];
    const finalPrice = gameState.apartmentPrice[15];
    const finalIncome = gameState.income[15];
    const years = finalPrice * 1000 / finalIncome / 12;
    
    let win = false;
    if (currentScenario !== 'sandbox') {
      win = finalInfl <= s.targetInflation && finalHouse >= s.targetHousing && finalTrust >= 30;
    } else {
      win = true;
    }

    if (win && currentScenario !== 'sandbox') {
      playSound('soundOvation');
      playVoice(19);
    }

    let mythAnalysis = '';
    if (currentScenario === 'sandbox') {
      mythAnalysis = 'üß™ –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç. –ù–∞–¥–µ–µ–º—Å—è, –≤—ã –ª—É—á—à–µ –ø–æ–Ω—è–ª–∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏.';
    } else if (finalInfl > s.targetInflation && finalHouse < s.targetHousing) {
      mythAnalysis = '‚ö° –ú–ò–§ –ü–û–î–¢–í–ï–†–î–ò–õ–°–Ø? –ù–µ—Ç! –í—ã —É–≤–∏–¥–µ–ª–∏, —á—Ç–æ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ –ø—Ä–∏–≤–µ–ª–æ –∫ —Ä–æ—Å—Ç—É —Ü–µ–Ω. –ñ–∏–ª—å—ë —Å—Ç–∞–ª–æ –º–µ–Ω–µ–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º.';
    } else if (finalInfl <= s.targetInflation && finalHouse >= s.targetHousing) {
      mythAnalysis = 'üèÜ –ú–ò–§ –†–ê–ó–í–ï–ù–ß–ê–ù! –í—ã –Ω–∞—à–ª–∏ –±–∞–ª–∞–Ω—Å: –Ω–∏–∑–∫–∞—è –∏–Ω—Ñ–ª—è—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∂–∏–ª—å—ë. –°—Ç–∞–≤–∫–∞ ‚Äî –Ω–µ –≥–ª–∞–≤–Ω–æ–µ, –≤–∞–∂–µ–Ω –∫–æ–º–ø–ª–µ–∫—Å –º–µ—Ä.';
    } else {
      mythAnalysis = 'üìö –ì–õ–ê–í–ù–´–ô –£–†–û–ö: –∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –≤–ª–∏—è–µ—Ç, –Ω–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –≤—Å—ë. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏, –¥–æ—Ö–æ–¥–æ–≤ –∏ –¥–æ–≤–µ—Ä–∏—è.';
    }

    const resultHtml = `
      <h2 class="${win ? 'win' : 'neutral'}" style="margin-bottom:15px;">${win ? 'üèÜ –í–´ –î–û–°–¢–ò–ì–õ–ò –¶–ï–õ–ï–ô!' : 'üéì –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢ –ó–ê–í–ï–†–®–Å–ù'}</h2>
      
      <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:30px; margin:20px 0;">
        <p><strong>–ò–Ω—Ñ–ª—è—Ü–∏—è:</strong> ${finalInfl.toFixed(1)}% ${currentScenario !== 'sandbox' ? `(—Ü–µ–ª—å ‚â§ ${s.targetInflation}%)` : ''}</p>
        <p><strong>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∂–∏–ª—å—è:</strong> ${finalHouse.toFixed(0)}/100 ${currentScenario !== 'sandbox' ? `(—Ü–µ–ª—å ‚â• ${s.targetHousing})` : ''}</p>
        <p><strong>–¶–µ–Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã:</strong> ${finalPrice.toFixed(1)} –º–ª–Ω ‚ÇΩ</p>
        <p><strong>–î–æ—Ö–æ–¥ —Å–µ–º—å–∏:</strong> ${finalIncome.toFixed(0)} —Ç—ã—Å. ‚ÇΩ/–º–µ—Å</p>
        <p><strong>–õ–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π:</strong> ${years.toFixed(1)} ${pluralizeYears(years)}</p>
      </div>
      
      <div style="background:rgba(255,215,0,0.1); padding:20px; border-radius:30px; margin:20px 0;">
        <p style="font-weight:bold; color:#ffd966;">üß† –†–ê–ó–ë–û–† –ú–ò–§–ê:</p>
        <p>${mythAnalysis}</p>
      </div>
      
      <p style="font-style:italic; margin:20px 0;">
        "–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî –Ω–µ –≤–æ–ª—à–µ–±–Ω–∞—è –∫–Ω–æ–ø–∫–∞. –í–∞–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞, –∏–Ω—Ñ–ª—è—Ü–∏—è –∏ –¥–æ—Ö–æ–¥—ã."
      </p>
      
      <button class="close-modal" onclick="closeResult()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π</button>
    `;
    
    document.getElementById('resultContent').innerHTML = resultHtml;
    document.getElementById('resultModal').style.display = 'flex';
    playVoice(20);
  }

  function showTerm(term) {
    const t = dictionary[term];
    document.getElementById('termTitle').textContent = t.title;
    document.getElementById('termText').textContent = t.text;
    document.getElementById('termModal').style.display = 'flex';
  }

  function closeTermModal() {
    document.getElementById('termModal').style.display = 'none';
  }

  function showHelp() {
    document.getElementById('helpModal').style.display = 'flex';
    playSound('soundButton');
  }

  function closeHelp() {
    document.getElementById('helpModal').style.display = 'none';
  }

  function closeResult() {
    document.getElementById('resultModal').style.display = 'none';
    restartScenario();
  }

  function restartScenario() {
    playSound('soundButton');
    loadScenario(currentScenario);
  }

  function createBg() {
    const bg = document.getElementById('currencyBg');
    const symbols = ['‚ÇΩ', '$', '‚Ç¨'];
    for (let i = 0; i < 30; i++) {
      const el = document.createElement('div');
      el.className = 'currency-symbol';
      el.textContent = symbols[Math.floor(Math.random() * symbols.length)];
      el.style.left = Math.random() * 100 + '%';
      el.style.top = Math.random() * 100 + '%';
      el.style.fontSize = (40 + Math.random() * 60) + 'px';
      el.style.animationDelay = Math.random() * 10 + 's';
      bg.appendChild(el);
    }
  }

  window.onload = function() {
    createBg();
    loadStyle();
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    loadScenario('ussr');

    document.getElementById('keyRateSlider').addEventListener('input', function(e) {
      document.getElementById('rateDisplay').textContent = e.target.value + '%';
      updateForecast();
    });
    
    document.getElementById('keyRateSlider').addEventListener('change', function() {
      playSound('soundSlider');
    });

    document.getElementById('applyBtn').addEventListener('click', applyDecision);
  };
</script>

</body>
</html>